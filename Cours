# **Cours complet : Projet Born2beRoot ‚Äì Installation et configuration d‚Äôun serveur Linux**

---

## **1Ô∏è‚É£ Syst√®mes d‚Äôexploitation et installation**

### a) Distributions √† conna√Ætre

* **Debian stable**

  * Stable = version test√©e, fiable.
  * Gestionnaire de paquets :

    * `apt` ‚Üí commandes simples pour installer, supprimer, mettre √† jour.
      Exemple : `sudo apt update && sudo apt upgrade`
    * `aptitude` ‚Üí plus avanc√©, interface en texte et r√©solution automatique des d√©pendances.
  * S√©curit√© : **AppArmor** pour restreindre le comportement des applications.
  * Id√©al pour d√©butants.
* **Rocky Linux stable**

  * Fork de RHEL, bas√© sur RedHat.
  * Gestionnaire de paquets : `dnf` ou `yum`

    * Exemple : `sudo dnf install vim`
  * S√©curit√© : **SELinux**
  * Installation plus complexe, mais stable et s√©curis√©e.

### b) Points cl√©s

* Installer **sans interface graphique**.
* Conna√Ætre les bases de `systemd` pour g√©rer les services :

  * `systemctl start/stop/status <service>`
  * `systemctl enable <service>` ‚Üí d√©marrage automatique
* Comprendre la structure des fichiers Linux :

  * `/etc/` ‚Üí configuration
  * `/var/log/` ‚Üí logs
  * `/home/` ‚Üí utilisateurs

---

## **2Ô∏è‚É£ Installation minimale et services**

### a) Services essentiels

* **SSH** : permet l‚Äôacc√®s distant s√©curis√©.
* **Firewall** : contr√¥le les ports ouverts.
* **Cron** : ex√©cute des t√¢ches planifi√©es (ex : monitoring script).
* Services syst√®me (`systemd`, `journald`, etc.)

### b) Commandes utiles

```bash
sudo systemctl status ssh
sudo systemctl enable ufw
sudo ufw allow 4242/tcp
```

### c) Bonnes pratiques

* Ne jamais installer de GUI.
* Ne garder que les services n√©cessaires pour r√©duire la surface d‚Äôattaque.

---

## **3Ô∏è‚É£ Gestion du stockage et LVM**

### a) Concepts cl√©s

* **LVM (Logical Volume Manager)** :

  * PV : Physical Volume (disque physique ou partition)
  * VG : Volume Group (regroupe les PV)
  * LV : Logical Volume (partition logique que tu peux redimensionner)
* **Partitions chiffr√©es** : s√©curisent les donn√©es (`cryptsetup luksFormat`).

### b) Commandes

```bash
sudo pvcreate /dev/sda2
sudo vgcreate vg_root /dev/sda2
sudo lvcreate -L 10G -n lv_home vg_root
sudo mkfs.ext4 /dev/vg_root/lv_home
sudo cryptsetup luksFormat /dev/sda2
```

### c) Astuces

* Choisir la taille des partitions selon l‚Äôusage :

  * `/` : 20‚Äì30 Go
  * `/home` : le reste
  * `swap` : 2√óRAM si petite RAM, sinon RAM

---

## **4Ô∏è‚É£ S√©curit√© du serveur**

### a) SSH

* Configuration dans `/etc/ssh/sshd_config` :

  ```
  Port 4242
  PermitRootLogin no
  PasswordAuthentication yes
  ```
* Red√©marrer SSH : `sudo systemctl restart ssh`

### b) Firewall

* Debian : **UFW**

  ```bash
  sudo ufw enable
  sudo ufw allow 4242/tcp
  sudo ufw status
  ```
* Rocky : **Firewalld**

  ```bash
  sudo systemctl enable firewalld
  sudo firewall-cmd --add-port=4242/tcp --permanent
  sudo firewall-cmd --reload
  ```

### c) SELinux / AppArmor

* **SELinux** : Mandatory Access Control (MAC)

  * Modes : Enforcing / Permissive / Disabled
  * V√©rifier : `getenforce`
* **AppArmor** : restreint l‚Äôacc√®s aux fichiers et actions par application

  * V√©rifier : `sudo aa-status`

---

## **5Ô∏è‚É£ Gestion des utilisateurs et groupes**

### a) Concepts

* Chaque utilisateur a un UID et un groupe principal.
* Les groupes permettent de g√©rer les permissions collectives.

### b) Commandes

```bash
sudo adduser monlogin
sudo usermod -aG sudo,user42 monlogin
sudo groupadd user42
sudo passwd monlogin
```

### c) Bonnes pratiques

* Ne jamais se connecter directement en root.
* Cr√©er un utilisateur avec sudo.
* Pouvoir expliquer la structure `/etc/passwd` et `/etc/group`.

---

## **6Ô∏è‚É£ Politique de mots de passe**

### a) Param√®tres √† appliquer

* Expiration : 30 jours
* Minimum : 2 jours
* Alerte : 7 jours avant expiration
* Longueur ‚â• 10, majuscule + minuscule + chiffre
* Pas de 3 caract√®res identiques cons√©cutifs
* Ne pas contenir le nom d‚Äôutilisateur

### b) Commandes utiles

```bash
sudo chage -M 30 -m 2 -W 7 monlogin
sudo passwd monlogin
sudo passwd root
```

### c) Astuce

* Modifier tous les mots de passe apr√®s configuration pour √™tre conforme.

---

## **7Ô∏è‚É£ Configuration de sudo**

### a) Fichier principal : `/etc/sudoers` (ou via `visudo`)

* Limiter tentatives : `Defaults passwd_tries=3`
* Message personnalis√© : `Defaults badpass_message="Erreur : mot de passe incorrect"`
* Activer TTY : `Defaults requiretty`
* Restriction du PATH :

  ```
  Defaults secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"
  ```
* Archiver les commandes :

  ```bash
  Defaults logfile="/var/log/sudo/sudo.log"
  ```

---

## **8Ô∏è‚É£ Monitoring et scripts**

### a) Script `monitoring.sh`

* Langage : Bash
* Commandes importantes :

  ```bash
  uname -a                 # architecture et kernel
  lscpu                     # processeurs
  free -h                   # RAM
  df -h                     # stockage
  top -bn1 | grep "Cpu(s)"  # CPU usage
  who                       # utilisateurs connect√©s
  ip a                      # IP
  cat /sys/class/net/eth0/address # MAC
  sudo cat /var/log/sudo/sudo.log | wc -l  # nb commandes sudo
  ```
* Diffuser √† tous les terminaux : `wall`
* Automatisation : `cron` :

  ```bash
  sudo crontab -e
  */10 * * * * /root/monitoring.sh
  ```

### b) Bonnes pratiques

* Pas d‚Äôerreur affich√©e.
* Script capable de s‚Äôarr√™ter proprement.
* Documenter chaque ligne pour la d√©fense.

---

## **9Ô∏è‚É£ Configuration syst√®me g√©n√©rale**

* Hostname : `sudo hostnamectl set-hostname wil42`
* V√©rifier : `hostnamectl`
* Services critiques activ√©s au d√©marrage : `systemctl enable <service>`
* V√©rifier avec `systemctl list-unit-files --type=service | grep enabled`

---

## **üîü Points cl√©s pour la d√©fense**

* Savoir expliquer :

  * Pourquoi LVM et partitions chiffr√©es
  * Pourquoi SSH sur un port non standard
  * Diff√©rence aptitude/apt
  * R√¥le de AppArmor ou SELinux
  * Comment fonctionne le script de monitoring
  * Politique de mots de passe et sudo
* Montrer toutes les commandes et fichiers de configuration utilis√©s.

---

